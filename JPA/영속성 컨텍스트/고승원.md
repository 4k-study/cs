# JPA 영속성 컨텍스트

엔티티를 관리하는 환경을 의미한다. ORM을 통해 객체와 DB 사이에서 상호작용할때 그 중간에서 사용되며, 엔티티의 상태 변화를 추적하고 DB에 변경을 반영한다.

EntityManager를 통해 접근하며, 쓰레드별로 접근하는 트랜잭션마다 EntityManager를 생성하여 영속성 컨텍스트에 접근한다. 트랜잭션이 시작될때 영속성 컨텍스트가 생성되고, 트랜잭션이 끝날때 EntityManager와 영속성 컨텍스트가 종료된다.

1. 엔티티의 생명주기 관리: 영속성 컨텍스트는 엔티티의 생성부터 삭제까지의 생명주기를 관리한다. 엔티티 객체를 영속성 컨텍스트에 저장하면, 해당 객체는 영속 상태가 된다. 이후 영속 상태의 엔티티는 데이터베이스와의 일관성을 유지하기 위해 관리된다.
    
![image](https://github.com/4k-study/cs/assets/85796588/f1135da1-d9b1-407e-92ed-61d3defb8cb7)    

2. 지연 로딩(Lazy Loading): 엔티티를 필요한 시점에 조회한다. 이를 통해 성능을 최적화할 수 있다. 지연 로딩은 엔티티의 연관 관계에서 필요한 시점에 관련된 데이터를 실제로 사용할 때 조회된다.
3. 동일성 보장: 동일한 식별자(primary key)를 가진 엔티티에 대해 동일한 인스턴스를 반환하여 동일성을 보장한다. 애플리케이션에서 엔티티를 동일성 비교할 때 편리하게 사용할 수 있다.
4. 변경 감지(Dirty Checking): 엔티티의 변경 사항을 감지하여 자동으로 데이터베이스에 반영한다. 변경된 엔티티는 커밋 시점에 데이터베이스에 자동으로 동기화된다.
5. 트랜잭션 범위 관리: 트랜잭션의 범위에 따라 동작합니다. 트랜잭션 시작 시점에 영속성 컨텍스트가 생성되고, 트랜잭션 종료 시점에 변경된 엔티티를 데이터베이스에 반영한다. 이를 통해 트랜잭션 단위로 일관된 데이터베이스 상태를 유지할 수 있다.
