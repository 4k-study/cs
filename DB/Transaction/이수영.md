# 트랜잭션이란?

트랜잭션은 DB의 상태 변화를 위해 수행되는 가장 작은 더 이상 쪼개질 수 없는 작업 단위입니다.

하나의 트랜잭션이 가진 작업들은 한 몸처럼 동작해야하기 때문에 예외 발생 시 전부 다 없던 작업으로 처리하는 롤백이 일어나고 성공하면 이를 DB에 반영하는 커밋이 발생합니다.

### 트랜잭션의 특성

트랜잭션은 4가지 특성을 가지는데요.

1. **원자성** : 더 이상 쪼개지지 않는다. 가장 작은 단위이다는 것을 의미합니다.
2. **일관성** : 트랜잭션이 성공된 후에도 DB가 일관되어야 한다는 것을 의미합니다. 그니까 이 트랜잭션의 결과로 DB 내에 모순된 데이터가 존재하면 안된다는 것입니다.
3. **격리성** : 실행 중인 트랜잭션의 중간결과를 다른 트랜잭션이 접근할 수 없다는 의미입니다.
4. **영속성** : 트랜잭션이 성공했을 때 그 결과가 DB에 영구적으로 저장되어야 한다는 의미입니다.

### 트랜잭션의 격리성

격리성은 실행 중인 트랜잭션의 중간결과에 다른 트랜잭션이 접근할 수 없다라고 설명했는데 사실 접근할 수 있습니다. 하지만 트랜잭션의 접근 레벨에 따라서 달라집니다. 격리성을 약하게 혹은 강하게 설정할 수 있습니다.

하지만 트랜잭션을 너무 약하게 설정할수록 문제가 많이 발생합니다.

1. **Dirty Read** : 다른 트랜잭션에 의해 수정되었지만 아직 커밋되지 않은 데이터를 읽는 문제입니다.
2. **Non-Reapeatable Read** : 하나의 트랜잭션에서 하나의 데이터를 2번 읽었을 때 그 결과값이 다르게 나오는 문제입니다.
3. **Phantom Read** : 하나의 트랜잭션에서 모든 데이터를 2번 조회했을 때 처음 조회에서는 없던 데이터가 이후 조회에서 나타나는 문제입니다.

### 트랜잭션의 격리 레벨

이런 문제들을 해결하기 위해서 접근 레벨을 올리면 되는데 너무 강한 접근 레벨을 설정한다면 성능적으로 문제가 발생할 수 있다는 트레이드오프가 존재합니다.

1. **Read Uncommited 레벨** : 트랜잭션에서 아직 커밋되지 않은 데이터를 읽을 수 있는 레벨입니다.
    - Dirty Read, Non-Reapeatable Read, Phantom Read
2. **Read Commited 레벨** : 트랜잭션에서 커밋된 데이터만 읽을 수 있는 레벨입니다.
    - Non-Reapeatable Read, Phantom Read
3. **Reapeatable Read 레벨** : 하나의 트랜잭션에서 특정 데이터를 2번 조회했을 때 같은 결과가 나오는 레벨입니다.
    - Phantom Read
4. **Serializable Read 레벨** : 트랜잭션 내에서 전체 조회 쿼리를 2번 날려도 이전 쿼리에 있던 데이터과 같은 결과가 나오는 레벨입니다.
