## **트랜잭션(Transaction)이란?**

- 트랜잭션 개념과 정의
    - DB 에서 데이터의 일관성과 무결성을 보장하기 위한 작업의 논리적 단위입니다.
    - 데이터베이스에서 여러 개의 작업이 동시에 실행될 때, 트랜잭션은 이러한 작업들을 논리적으로 묶어서 처리하며, 한 번에 모두 실행되거나 모두 실행되지 않게 합니다.
- 트랜잭션의 필요성
    - 예를 들어, 은행에서 계좌 이체 작업을 할 때, 이체 작업이 완료되기 전에 다른 사용자가 해당 계좌에 접근해서 데이터를 변경하는 것을 방지할 수 있습니다.
    - 또한, 트랜잭션을 이용하면 작업 중에 문제가 발생하여 작업이 중단될 경우, 작업을 이전 상태로 되돌릴 수 있습니다.

## **트랜잭션의 특징**

- 원자성(Atomicity): 트랜잭션은 하나의 논리적인 작업 단위로, 모든 연산이 반영되거나 전혀 반영되지 않아야 합니다.
- 일관성(Consistency): 트랜잭션이 실행을 성공적으로 완료하면, 데이터베이스는 일관된 상태가 되어야 합니다. 즉, 트랜잭션이 일어난 이후의 데이터베이스는 데이터베이스의 제약이나 규칙을 만족해야 한다는 뜻입니다.
- 격리성(Isolation): 둘 이상의 트랜잭션이 동시에 실행될 때 각각의 트랜잭션은 다른 트랜잭션의 연산에 영향을 받지 않아야 합니다.
- 지속성(Durability): 트랜잭션이 성공적으로 완료되면, 해당 결과는 영구적으로 데이터베이스에 반영되어야 합니다.

## 트랜잭션 전파 수준

- REQUIRED
    - 이미 시작된 트랜잭션이 있으면 참여하고 없으면 새로 시작합니다.
- SUPPORTS
    - 이미 시작된 트랜잭션이 있으면 참여하고, 없으면 트랜잭션 없이 진행합니다.
    - 트랜잭션이 없어도 해당 경계 안에서 Connection 객체나 하이버네이트의 Session 등은 공유 할 수 있습니다.
- MANDATORY
    - 이미 시작된 트랜잭션이 있으면 참여하고, 없으면 예외를 발생시킵니다.
    - 혼자서 독립적으로 트랜잭션을 진행하면 안되는 경우에 사용
- REQUIRES_NEW
    - 이미 진행중인 트랜잭션이 있으면 이를 보류시키고 새로운 트랜잭션을 만들어 시작합니다.
    - 항상 새로운 트랜잭션을 시작해야 하는 경우에 사용합니다.
- NOT_SUPPORTED
    - 트랜잭션 없이 실행합니다. 현재 진행 중인 트랜잭션이 있으면 중단 후, 트랜잭션 없이 실행합니다.
- NEVER
    - 트랜잭션 없이 실행합니다. 현재 진행 중인 트랜잭션이 있으면 예외를 발생시킵니다.
- NESTED
    - 이미 진행중인 트랜잭션이 있으면 중첩 트랜잭션을 시작합니다.
    - 중첩 트랜잭션은 트랜잭션 안에 다시 트랜잭션을 만드는 것으로, 독립적인 트랜잭션을 만드는 REQUIRES_NEW 와는 다릅니다.
    - NESTED 에 의한 중첩 트랜잭션은 먼저 시작된 부모 트랜잭션의 커밋과 롤백에는 영향을 받지만, 자신의 커밋과 롤백은 부모 트랜잭션에게 영향을 주지 않습니다.

## **트랜잭션 격리 수준**

여러 개의 트랜잭션이 동시에 실행될 때, 이들 간의 상호작용을 제어하는 방식입니다.

아래는 트랜잭션 전파 수준의 종류입니다.

- READ UNCOMMITTED
    - 가장 낮은 수준의 트랜잭션 전파 수준입니다.
    - 다른 트랜잭션에서 변경한 데이터를 읽을 수 있으며, 커밋되지 않은 데이터까지 읽을 수 있습니다.
    - 이로 인해, Dirty Read(더티 리드)라는 현상이 발생할 수 있습니다.
- READ COMMITTED
    - 커밋된 데이터만 읽을 수 있으며, 다른 트랜잭션이 변경하고 커밋하지 않은 정보는 읽을 수 없습니다.
    - Dirty Read는 발생하지 않지만, Non-Repeatable Read(비반복성 읽기)라는 현상이 발생할 수 있습니다.
- REPEATABLE READ
    - 하나의 트랜잭션이 읽은 로우를 다른 트랜잭션이 수정할 수 없도록 막아주기에 트랜잭션이 시작되고 종료될 때까지 동일한 데이터를 읽을 수 있습니다. 다만, 새로운 로우를 추가하는 것은 막지 않습니다.
    - Non-Repeatable Read는 발생하지 않지만, Phantom Read(유령 읽기)라는 현상이 발생할 수 있습니다.
- SERIALIZABLE
    - 가장 높은 수준의 트랜잭션 전파 수준입니다.
    - 트랜잭션 간에 상호작용이 발생하지 않도록 보장합니다.
    - Dirty Read, Non-Repeatable Read, Phantom Read 등의 현상이 발생하지 않습니다.

트랜잭션 전파 수준은 데이터베이스 시스템의 특성과 요구사항에 맞게 설정되어야 합니다. 더 높은 수준의 트랜잭션 전파 수준은 더 높은 일관성을 보장하지만, 동시성이 낮아질 수 있고, 성능도 저하될 수 있습니다.
