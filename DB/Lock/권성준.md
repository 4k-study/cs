## Lock

- 트랜잭션 처리의 순서를 보장하기 위한 방법

## Lock 의 종류

### 공유 락

- 데이터를 읽을 때 사용되어지는 락
- 공유 락끼리는 동시에 접근이 가능함
    - 조회는 동시에 가능하다는 의미
    - 공유 락이 설정된 데이터에 베타 락을 사용할 수 는 없음

### 베타 락

- 데이터를 변경하고자할 때 사용되는 락
- 트랜잭션이 완료될 때까지 유지됨
- 베타 락이 해제될 때까지 다른 트랜잭션은 해당 데이터에 접근할 수 없음

## Lock 전략

### 비관적 락

- 특징
    - 동시성 문제가 발생할 것이라고 가정하고 DB 에 Lock 을 걸어버리는 방법
    - 하나의 트랜잭션 시 자원에 접근 시 락을 걸고 다른 트랜잭션은 접근하지 못하게 함
    - DB 에서 공유 락이나 베타 락을 사용함
- 사용 예
    - 데이터 무결성이 중요하고 충돌이 잦은 경우
- 장점
    - 충돌이 잦은 환경에서 롤백을 줄일 수 있어 성능에 유리
    - 데이터 무결성 수준이 매우 높음
- 단점
    - 데이터 자체에 락을 걸어버리므로 조회가 많은 환경에서 동시성이 떨어짐
    - 서로 자원이 필요한 경우 데드락이 발생할 수 있음

### 낙관적 락

- 특징
    - 데이터에 락을 걸지 않고, 충돌이 발생하면 그때 처리하자는 방법
    - 일반적으로 버전의 상태를 보고, 충돌이 발생하면 롤백함
    - DB 단이 아닌 어플리케이션 단에서 동시성을 처리함
- 사용 예
    - 데이터의 충돌이 많이 일어나지 않을 것이라고 예상되고 무결성이 정말 중요하지 않은 경우
- 장점
    - 기대했던 대로 충돌이 잦지 않으면, 비관적 락에 비해 조회 성능이 좋음
- 단점
    - 잦은 충돌이 일어나면 롤백 처리때문에 성능에서 오히려 손해일 수 있음
    - 롤백 처리 구현이 복잡할 수 있음
